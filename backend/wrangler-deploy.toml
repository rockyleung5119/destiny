# Wrangler 部署配置文件 - 简化版
# 移除可能导致部署失败的高级功能，确保基础功能正常部署

name = "destiny-backend"
main = "worker-deploy.ts"
compatibility_date = "2024-08-01"

# 环境变量配置（非敏感信息）
[vars]
NODE_ENV = "production"
CORS_ORIGIN = "https://destiny-frontend.pages.dev"
FRONTEND_URL = "https://destiny-frontend.pages.dev"
DEEPSEEK_BASE_URL = "https://api.siliconflow.cn/v1/chat/completions"
DEEPSEEK_MODEL = "Pro/deepseek-ai/DeepSeek-R1"
EMAIL_SERVICE = "resend"
RESEND_FROM_EMAIL = "info@info.indicate.top"
RESEND_FROM_NAME = "indicate.top"

# D1数据库绑定
[[d1_databases]]
binding = "DB"
database_name = "destiny-db"
database_id = "500716dc-3ac2-4b4a-a2ee-ad79b301228d"

# 定时任务配置 - 每2分钟自动处理卡住的任务
[triggers]
crons = ["*/2 * * * *"]

# 注释掉可能导致部署失败的高级功能
# 部署成功后可以逐步启用这些功能

# Durable Objects配置 - 暂时禁用
# [[durable_objects.bindings]]
# name = "AI_PROCESSOR"
# class_name = "AIProcessor"

# [[durable_objects.bindings]]
# name = "BATCH_COORDINATOR"
# class_name = "BatchCoordinator"

# [[migrations]]
# tag = "v1"
# new_classes = ["AIProcessor", "BatchCoordinator"]

# Cloudflare Queues配置 - 暂时禁用
# [[queues.producers]]
# binding = "AI_QUEUE"
# queue = "ai-processing-queue"

# [[queues.consumers]]
# queue = "ai-processing-queue"
# max_batch_size = 1
# max_batch_timeout = 300
# max_retries = 1
# dead_letter_queue = "ai-processing-dlq"

# [[queues.producers]]
# binding = "AI_DLQ"
# queue = "ai-processing-dlq"
